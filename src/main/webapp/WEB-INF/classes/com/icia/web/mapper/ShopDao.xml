<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.icia.web.dao.ShopDao">

	<resultMap id="ShopResultMap" type="com.icia.web.model.Shop">
	<id column="SHOP_UID" property="shopUID"/>
	<result column="USER_UID" property="userUID"/>
	<result column="SHOP_NAME" property="shopName"/>
	<result column="SHOP_TYPE" property="shopType"/>
	<result column="SHOP_HOLIDAY" property="shopHoliday"/>
	<result column="SHOP_HASHTAG" property="shopHashtag"/>
	<result column="SHOP_LOCATION1" property="shopLocation1"/>
	<result column="SHOP_LOCATION2" property="shopLocation2"/>
	<result column="SHOP_LOCATION3" property="shopLocation3"/>
	<result column="SHOP_ADDRESS" property="shopAddress"/>
	<result column="SHOP_TELEPHONE" property="shopTelephone"/>
	<result column="SHOP_INTRO" property="shopIntro"/>
	<result column="SHOP_CONTENT" property="shopContent"/>
	<result column="REG_DATE" property="shopRegDate"/>
	<collection property="shopFile" resultMap="ShopFileResultMap"/>
	</resultMap>
	
	<resultMap id="ShopFileResultMap" type="com.icia.web.model.ShopFile">
	<id column="SHOP_UID" property="shopUID"/>
	<result column="FILE_SEQ" property="shopFileSeq"/>
	<result column="FILE_ORG_NAME" property="shopFileOrgName"/>
	<result column="FILE_NAME" property="shopFileName"/>
	<result column="FILE_EXT" property="shopFileExt"/>
	<result column="FILE_SIZE" property="shopFileSize"/>
	<result column="REG_DATE" property="shopFileRegDate"/>
	</resultMap>


	<select id="shopListTotlaCount" resultType="long" parameterType="com.icia.web.model.Shop">
		SELECT COUNT(A.SHOP_UID) AS CNT
	  FROM T_SHOP A, T_SHOP_FILE B
	 WHERE A.SHOP_UID = B.SHOP_UID
<if test='searchType != null and searchType != "0" '>
	<choose>
		<when test='searchType == "1"'>   
                   AND SHOP_TYPE = #{searchType}
		</when>
		<when test='searchType == "2"'>
                   AND SHOP_TYPE = #{searchType}
		</when>
	</choose>
</if>  
	</select>
	
	<select id="shopList"  parameterType="com.icia.web.model.Shop" resultMap="ShopResultMap">
		SELECT *
	  FROM (SELECT  ROWNUM AS RNUM,
	                A.SHOP_UID AS SHOP_UID,
	                NVL(A.SHOP_NAME, '') AS SHOP_NAME,
	                NVL(A.SHOP_TYPE, '') AS SHOP_TYPE,
	                NVL(A.SHOP_HASHTAG, '') AS SHOP_HASHTAG,
	                NVL(A.SHOP_LOCATION1, '') AS SHOP_LOCATION1,
	                NVL(A.SHOP_LOCATION2, '') AS SHOP_LOCATION2,
	                NVL(A.SHOP_LOCATION3, '') AS SHOP_LOCATION3,
	                NVL(A.SHOP_ADDRESS, '') AS SHOP_ADDRESS,
	                NVL(A.SHOP_INTRO, '') AS SHOP_INTRO,
	                NVL(B.FILE_SEQ, 0) AS FILE_SEQ,
	                NVL(B.FILE_ORG_NAME, '') AS FILE_ORG_NAME,
	                NVL(B.FILE_NAME, '') AS FILE_NAME,
	                NVL(B.FILE_EXT, '') AS FILE_EXT,
	                NVL(B.FILE_SIZE, 0) AS FILE_SIZE
	           FROM T_SHOP A, T_SHOP_FILE B
	          WHERE A.SHOP_UID = B.SHOP_UID
        <if test='searchType != null and searchType != "0" '>
			<choose>
				<when test='searchType == "1"'>   
			                  AND SHOP_TYPE = '1'
				</when>
				<when test='searchType == "2"'>
			                  AND SHOP_TYPE = '2'
				</when>
			</choose>
		</if> 
            )
 WHERE RNUM <![CDATA[>=]]>  #{startRow}
   AND RNUM <![CDATA[<=]]>  #{endRow}
	</select>
</mapper>
